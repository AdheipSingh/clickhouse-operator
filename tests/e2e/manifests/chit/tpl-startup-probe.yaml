apiVersion: "clickhouse.altinity.com/v1"
kind: "ClickHouseInstallationTemplate"

metadata:
  name: startup-probe
spec:
  templating:
    policy: auto
  configuration:
    users:
      probe/password: probe
      probe/profile: readonly
  templates:
    podTemplates:
      - name: clickhouse-replica-1
        spec:
          containers:
            - name: clickhouse-pod
              startupProbe:
                httpGet:
                  path: "/?query=select throwIf(uptime()<300)&user=probe&password=probe"
                  port: 8123
                  scheme: HTTP
                initialDelaySeconds: 30
                periodSeconds: 3
                failureThreshold: 10